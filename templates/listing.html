{% extends "layout.html" %} {% block title %}Ilmoitus - TechTori{% endblock %}
{% block css %}
<link rel="stylesheet" href="/static/css/listing.css" />
{% endblock %} {% block content %}
<div class="title-row">
  <h1>{{ listing.title }}</h1>
  {% if session.user_id and session.user_id != listing.user_id %}
  <form action="/favorite/{{ listing.id }}" method="post">
    <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
    <input type="hidden" name="redirect" value="{{ request.path }}" />
    {% if is_favorited %}
    <button type="submit" class="btn">Poista suosikeista</button>
    {% else %}
    <button type="submit" class="btn secondary">Lisää suosikkeihin</button>
    {% endif %}
  </form>
  {% endif %}
</div>

<div class="listing-details">
  <div class="listing-price">
    <p>{% if is_sold %}Myyty hinnalla {% else %}Myydään{% endif %}</p>
    <div>{{ listing.price }} €</div>
  </div>
  <hr />
  <div class="info">
    <span>Kategoria: <strong>{{ listing.category }}</strong></span>
    <span>Kunto: <strong>{{ listing.condition }}</strong></span>
  </div>
  {% if listing.description %}
  <p class="listing-description">{{ listing.description | show_lines }}</p>
  {% endif %}
  <p><strong>Luotu:</strong> {{ listing.created_at }}</p>
  {% if listing.favorites_count > 0 %}
  <p>
    <strong>Suosikkeihin lisätty:</strong> {{ listing.favorites_count }} kertaa
  </p>
  {% endif %}
  <p>
    <strong>Myyjä:</strong>
    <a href="/profile/{{ listing.user_id }}">{{ listing.username }}</a>
  </p>

  <div class="actions">
    {% if listing.user_id == session.get("user_id") %}
    <a href="/edit-listing/{{ listing.id }}" class="btn secondary"
      >Muokkaa ilmoitusta</a
    >
    <a href="/delete-listing/{{ listing.id }}" class="btn secondary"
      >Poista ilmoitus</a
    >
    {% if is_sold %}
    <form action="/unsell-listing/{{ listing.id }}" method="post">
      <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
      <button type="submit" class="btn">Myynnin peruminen</button>
    </form>
    {% endif %} {% elif session.get("user_id") and not is_sold %}
    <form action="/buy-listing/{{ listing.id }}" method="post">
      <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
      <button type="submit" class="btn">Osta ilmoitus</button>
    </form>
    {% elif is_sold %}
    <p class="is_sold">Ilmoitus on myyty.</p>
    {% else %}
    <a href="/login" class="btn">Kirjaudu sisään ostaaksesi ilmoituksen</a>
    {% endif %}
  </div>
</div>
{% endblock %}
